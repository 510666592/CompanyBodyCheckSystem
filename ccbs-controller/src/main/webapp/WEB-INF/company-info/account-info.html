<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>团检单位信息</title>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/assets/css/toastr.min.css" rel="stylesheet"/>
    <link href="/assets/css/open-iconic-bootstrap.min.css" rel="stylesheet"/>
    <link href="/assets/css/juer-style.css" rel="stylesheet"/>

    <style>
        table, th, td {
            border: 1px solid grey;
            border-collapse: collapse;

            padding: 5px;
        }

        table tr:nth-child(odd) {
            background-color: #f1f1f1;
        }

        table tr:nth-child(even) {
            background-color: #ffffff;
        }

        td {
            width: 180px;
        }
    </style>
</head>
<body ng-app="accountApp">
<h1 align="center">账户信息</h1>

<div>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#add-users">添加体检人员</button>
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#recharge">账户充值</button>
</div>

<!--添加体检人员模态框-->
<div class="modal fade" id="add-users" aria-labelledby="add-users-title" aria-hidden="true" ng-controller="addUsersController">
    <div class="modal-dialog">
        <div class="modal-content">
                <!--模态框标题-->
                <div class="modal-header">
                    <h4 class="modal-title" id="add-users-title">
                        添加体检人员
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <!--模态框内容-->
                <div class="modal-body">
                    <p>选择文件:</p><input type="file" id="userNameList" name="userNameList" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ng-model="userNameList">
                    <button type="button" class="btn btn-primary float-right" ng-click="onload()">确定</button>
                    <!--人员显示-->
                    <div align="center">
                        <table>
                            <thead>
                            <tr>
                                <td>姓名</td>
                                <td>性别</td>
                                <td>年龄</td>
                                <td>手机号</td>
                                <td>身份证</td>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="user in userList">
                                <td ng-repeat="x in user">{{x}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--模态框底部-->
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="submitUsers()">提交
                    </button>
                </div>
        </div>
    </div>
</div>


<!--充值模态框-->
<div class="modal fade" id="recharge" aria-labelledby="recharge-title" aria-hidden="true" ng-controller="rechargeController">
    <div class="modal-dialog">
        <div class="modal-content" >
            <form ng-submit="rechargeSubmitForm()" name="rechargeForm" novalidate>
                <!--模态框标题-->
                <div class="modal-header">
                    <h4 class="modal-title" id="recharge-title">
                        请输入充值金额
                    </h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                </div>
                <!--模态框内容-->
                <div class="modal-body">

                    <p>充值金额：
                        <input type="text" name="rechargePrice" ng-model="rechargePrice"
                               ng-maxlength="6" placeholder="请输入充值金额" required>
                        <span class="text-danger" ng-show="rechargeForm.rechargePrice.$error.required">请输入充值金额</span>
                        <span class="text-danger"
                              ng-show="rechargeForm.rechargePrice.$error.maxlength">充值金额位数最多为6位</span>

                    </p>

                </div>
                <!--模态框底部-->
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" ng-disabled="rechargeForm.rechargePrice.$dirty
                    && rechargeForm.rechargePrice.$invalid">充值
                    </button>

                </div>
            </form>
        </div>
    </div>

</div>


<!--账户信息显示-->
<div align="center" ng-controller="accountController">
    <table>
        <thead>
        <tr>
            <td colspan="2">
                <p>账户信息</p>
            </td>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>单位名称：</td>
            <td>{{account.accountname}}</td>
        </tr>
        <tr>
            <td>单位手机：</td>
            <td>{{company.companyphone}}</td>
        </tr>
        <tr>
            <td>单位邮箱：</td>
            <td>{{company.companyemail}}</td>
        </tr>
        <tr>
            <td>账户余额：</td>
            <td>{{company.companyprice | currency}}元</td>
        </tr>
        </tbody>
    </table>
</div>

<!--体检人员信息-->
<div align="cenger" ng-controller="selectUsersController">
    <p align="cengter">已添加体检人员信息</p>
    <button type="button" class="btn btn-primary" ng-click="selectUsers()">查看</button>
    <table>
        <thead>
            <tr>
                <td>姓名</td>
                <td>性别</td>
                <td>年龄</td>
                <td>手机</td>
                <td>身份证</td>
            </tr>
        </thead>
        <tbody>
        <tr ng-repeat="user in userList">
            <td ng-repeat="x in user">{{x}}</td>
        </tr>
        </tbody>
    </table>
</div>
</body>
<script src="/assets/scripts/angular.min.js"></script>
<script src="/assets/scripts/jquery.min.js"></script>
<script src="/assets/scripts/bootstrap.min.js"></script>
<script src="/assets/scripts/bootstrap.bundle.min.js"></script>
<script src="/assets/scripts/toastr.min.js"></script>
<script src="/assets/scripts/md5.min.js"></script>
<script src="/assets/scripts/base64.min.js"></script>
<script src="/assets/scripts/juer-script.js"></script>
<script>
    var app = angular.module('accountApp', []);
    app.controller('accountController', function ($scope, $http) {
        $http.post("/company-info/account-info")
            .then(
                function success(msg) {
                    var msg = msg.data;
                    console.log("返回" + msg.data);
                    console.log("account:" + msg.data.account);
                    $scope.account = msg.data.account;
                    $scope.company = msg.data.company;
                }, function error(msg) {
                    toastr.error(msg.data.message);
                }
            )
    });
    //充值
    app.controller('rechargeController',function ($scope) {
        $scope.rechargeSubmitForm=function () {

        }
    })
    //添加体检人员名单
    app.controller('addUsersController',function ($scope,$http) {
        $scope.userList = [];
        //上传人员名单
        $scope.onload=function () {
            var form = new FormData();
            var file = document.getElementById("userNameList").files[0];
            if (file!=null) {
                form.append('userNameList', file);
                juerCore.post("/company-info/user-list",
                    form,
                    function (msg) {
                        if (msg.state == 200) {
                            $scope.userList = msg.data;
                            console.log($scope.userList);
                            $scope.$apply();
                        } else {
                            window.alert(msg.message);
                        }
                    },
                    true
                );
            }else {
                window.alert("请选择Excel文档！");
            }
        };
        //提交人员名单
        $scope.submitUsers=function () {
            console.log("体检人信息："+$scope.userList);
            if ($scope.userList!=null){
                $http.post("/company-info/submit-users",$scope.userList
                ).then(
                    function success (response) {
                        window.alert("提交成功！共提交"+response.data.data+"条信息")
                    },function error (response) {
                        window.alert("提交失败！")
                    }
                )
            } else {
                window.alert("请先添加体检人员名单！");
            }

        }

    });
    //查看体检人员名单
    app.controller('selectUsersController',function ($scope,$http) {
        $scope.selectUsers=function () {
            $http.post("/company-info/select-users"
            ).then(
                function success (response) {

                },function error (response) {

                }
            )
        }

    })
</script>
</html>