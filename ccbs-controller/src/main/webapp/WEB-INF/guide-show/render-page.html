<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>渲染页面</title>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/assets/css/toastr.min.css" rel="stylesheet"/>
    <link href="/assets/css/open-iconic-bootstrap.min.css" rel="stylesheet"/>
    <link href="/assets/css/juer-style.css" rel="stylesheet"/>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-8 justify-content-center">
            <h2>导检单</h2>
            <hr/>
            <h3>POWERED BY @YYM-TEAM</h3>
        </div>
    </div>
    <hr/>
    <div class="row">
        <div class="col justify-content-center">
            <!--个人基本信息展示-->
            <table class="w-100">
                <thead>
                <tr>
                    <th class="th-width-20p"></th>
                    <th class="th-width-10p"></th>
                    <th class="th-width-40p"></th>
                    <th class="th-width-30p"></th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="font-size-16px text-right">姓名: </td>
                    <td></td>
                    <td class="font-size-16px text-left">{{user.username}}</td>
                    <td rowspan="3">
                        <img class="img-thumbnail" src="{{qrcode}}" alt="个人二维码"/>
                    </td>
                </tr>
                <tr>
                    <td class="font-size-16px text-right">性别: </td>
                    <td></td>
                    <td class="font-size-16px text-left">{{user.usergender?"女":"男"}}</td>
                </tr>
                <tr>
                    <td class="font-size-16px text-right">年龄: </td>
                    <td></td>
                    <td class="font-size-16px text-left">{{user.userage}}</td>
                </tr>
                </tbody>
            </table>
            <hr/>
            <!--体检项目展示-->
            <table class="w-100 border-right border-bottom">
                <thead>
                <tr>
                    <th class="font-size-20px font-weight-bold th-width-30p">体检项目</th>
                    <th class="th-width-5p"></th>
                    <th class="font-size-20px font-weight-bold th-width-30p">体检科室</th>
                    <th class="th-width-5p"></th>
                    <th class="font-size-20px font-weight-bold th-width-30p">主检医生签名</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="x in user.checkList" class="juer-row">
                    <td class="border-left border-top"><span title="{{x.checkname}}">{{x.checkname}}</span></td>
                    <td></td>
                    <td class="border-left border-top">{{x.dept.deptname}}</td>
                    <td></td>
                    <td class="border-left border-top"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
</body>
<script src="/assets/scripts/angular.min.js"></script>
<script src="/assets/scripts/jquery.min.js"></script>
<script src="/assets/scripts/bootstrap.min.js"></script>
<script src="/assets/scripts/bootstrap.bundle.min.js"></script>
<script src="/assets/scripts/toastr.min.js"></script>
<script src="/assets/scripts/md5.min.js"></script>
<script src="/assets/scripts/base64.min.js"></script>
<script src="/assets/scripts/juer-script.js"></script>
<script>
    let renderApp = angular.module("renderApp", []);
    renderApp.controller("renderController", ["$scope", "$location", "$http", function($scope, $location, $http) {
        let usercheckid = $location.search().usercheckid;

        $http.post("/guide-show/get-user-check", usercheckid)
            .then(
                function success(response) {
                    let msg = response.data;
                    $scope.user = msg.data;
                }, function error(response) {
                    toastr.error("发生了一些意料之外的错误，详情已输出至控制台。");
                    console.error(response.data);
                }
            )

        let getQrCode = function(user) {
            $http.post("/guide-show/get-user-qrcode", user)
                .then(
                    function success(response) {
                        let msg = response.data;
                        $scope.qrcode = `data:image/png;base64,${msg.data}`;
                    },
                    function error(response) {
                        toastr.error("发生了一些意料之外的错误，详情已输出至控制台。");
                        console.error(response.data);
                    }
                )
        }
    }]);
</script>
</html>